server {
  listen {{ deploy_nginx_listen | default(80) }};
  server_name www.{{ deploy_nginx_server_name[1:] }};
  return 301 $scheme://{{ deploy_nginx_server_name[1:] }}$request_uri;
}

server {

  listen {{ deploy_nginx_listen | default(80) }};

  server_name {{ deploy_nginx_server_name }};
  
  set $project_root {{ deploy_nginx_root }};
  set $project_src $project_root/src;
  
  location ~* ^/favicon\.[\w]+$ {
    root $project_src/static/img;
  }

  location ~* /(static|media) {
    root $project_src;
  }

  location ~* ^/(?!sitemap)[-\w]+\.(txt|xml|html)$ {
    root $project_sr{{ deploy_nginx_meta_sufix }};
  }

  location / {
    root $project_src;
    include uwsgi_params;
    uwsgi_pass {{ deploy_nginx_uwsgi_pass }};

  {% for option in deploy_nginx_uwsgi_options %}
    {{option}};
  {% endfor %}
  }
}
